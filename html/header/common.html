<style>
    #main {
        font-size: max(14pt, min(1.5rem, 5vw));
        width: max(min(80%, 20rem), calc(100% - min(45%, 250px) - 1rem));
        position: absolute;
        left: 50%;
        transform: translateX(-50%);
    }
    html {
        scroll-padding-top: 2.5rem;
        overflow-y: auto;
    }
    body {
        scroll-padding-top: 2.5rem;
        overflow-y: hidden;
        max-width: none !important;
    }
    blockquote {
        margin: 1rem 0.5rem;
    }
    blockquote p {
        background-color: #ebebeb;
        padding: 0.5rem;
    }
    details {
        cursor: pointer;
    }
    figure {
        margin-inline: 0.5rem;
    }
    figure img {
        display: block;
        margin-left: auto;
        margin-right: auto;
        max-width: 100%;
    }
    figure figcaption {
        font-size: max(12pt, min(1.1rem, 5.5vw));
        text-align: center;
    }
    a {
        color: blue;
    }
    a:visited {
        color: purple;
    }
    h1 {
        position: relative;
        margin-top: 5rem;
    }
    h1:before {
        content: '';
        position: absolute;
        width: 100%;
        height: 1px;
        background: black;
        bottom: 150%;
        left: 0;
    }
    *[role="doc-biblioref"] {
        color: green !important;
    }
    div.sourceCode {
        background-color: #dfdfdf;
        padding: 0.5rem;
        border: 1pt solid black;
        font-size: max(12pt, min(1.1rem, 5.5vw));
    }
    .copyButton {
        float: right;
        cursor: pointer;
    }
    @keyframes fade {
        0%,100% { opacity: 0 }
        15% { opacity: 1 }
        85% { opacity: 1 }
    }
    .copyMessage {
        position: absolute;
        transform: translate(-2rem, -2.8rem);
        width: 4rem;
        font-size: max(10pt, min(0.7rem, 4vw));
        text-align: center;
        background-color: #eee;
        border: 1pt solid black;
        border-radius: 0.25rem;
        animation: fade 2s linear;
    }
</style>
<script>
    window.onload = () => {
        addRefsToToc();
        eqRefExpandLinksAndAddTooltips();
        addRefTooltips();
        addFootnoteTooltips();
        addCodeCopyButtons();
    }
    addCodeCopyButtons = () => {
        buttonAddFunc = () => {
            copyButtons = document.querySelectorAll('.copyButton');
            wide = 700;
            if (copyButtons.length > 0) {
                if (window.innerWidth < wide) {
                    for (cb of copyButtons){
                        cb.remove();
                    }
                }
            } else {
                if (window.innerWidth >= wide) {
                    for (el of document.querySelectorAll('div.sourceCode')){
                        copyEl = document.createElement('span');
                        el.insertBefore(copyEl, el.firstChild);
                        copyEl.innerHTML = 'ðŸ“‹';
                        copyEl.classList = ['copyButton'];
                        ((el, copyEl) => {
                            copyEl.onclick = () => {
                                text = el.getElementsByTagName('pre')[0].textContent;
                                navigator.clipboard.writeText(text);
                                infoEl = document.createElement('div');
                                infoEl.textContent = 'Copied!';
                                infoEl.classList = ['copyMessage']
                                copyEl.appendChild(infoEl);
                                setTimeout(() => infoEl.remove(), 2000);
                            };
                        })(el, copyEl)
                    }
                }
            }
        }
        buttonAddFunc();
        window.addEventListener("resize", buttonAddFunc);
    }
    addRefsToToc = () => {
        liEl = document.createElement('li');
        aEl = document.createElement('a');
        aEl.href = '#References';
        aEl.innerHTML = 'References';
        ulEl = document.getElementById('TOC').getElementsByTagName('ul')[0];
        liEl.appendChild(aEl);
        ulEl.appendChild(liEl);
    }
    addTooltips = (els, includeLinkBacks) => {
        for (el of els) {
            refId = el.getAttribute('href');
            refEl = document.getElementById(refId.slice(1));
            el.setAttribute('href', '#');
            el.classList = ['eqnRef'];
            nextEl = document.createElement('span');
            el.parentNode.insertBefore(nextEl, el.nextSibling);
            popupId = refId + 'popup' + el.getBoundingClientRect().left + el.getBoundingClientRect().right;
            elId = popupId + 'Ref';
            nextEl.id = elId;
            ((a, b, c, d, e) => {
                a.onclick = () => {
                    footnoteOnTooltipClick(b, c, d, e);
                    return false
                };                
            })(el, popupId, refEl.innerHTML, elId, includeLinkBacks ? refId.slice(1) : null)
            if (includeLinkBacks) {
                backId = 'back' + refId;
                backEl = document.getElementById(backId);
                if (!!!backEl) {
                    backEl = document.createElement('div');
                    backEl.id = backId;
                    backArrowEl = document.createElement('a');
                    backArrowEl.id = backId + 'Arrow';
                    backArrowEl.innerHTML = "â†©ï¸Ž";
                    backArrowEl.style.float = 'right';
                    backArrowEl.style.display = 'none';
                    backEl.onclick = () => backEl.style.display = 'none';
                    backEl.appendChild(backArrowEl);
                    refEl.appendChild(backEl);
                }
            }
        }
    }
    eqRefExpandLinksAndAddTooltips = () => {
        els = document.querySelectorAll('[href^="\#eq:"]');
        addTooltips(els, true)
        for (const el of els) {
            sib = el.previousSibling;
            sibTextSplit = sib.textContent.split(/\s+/).filter(s => s !== '')
            prevWord = sibTextSplit[sibTextSplit.length - 1];
            if (['eq.', 'Equation'].includes(prevWord)){
                repS = RegExp(`${prevWord}[^a-zA-Z]$`)
                el.innerHTML = prevWord + ' ' + el.innerHTML;
                sib.textContent = sib.textContent.replace(repS, '');
            }
        }
    }
    addRefTooltips = () => {
        els = document.getElementById('main').getElementsByClassName('citation');
        addTooltips([...els].map(el => el.getElementsByTagName('a')[0]), false);
    }
    addFootnoteTooltips = () => {
        for (fnBack of [...document.getElementById('main').getElementsByClassName('footnote-back')]) {
            fnBack.remove();
        }
        els = document.getElementById('main').getElementsByClassName('footnote-ref');
        addTooltips([...els], false);
        document.getElementById('footnotes').remove();
    }
</script>