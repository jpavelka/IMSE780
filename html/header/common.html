<style>
    #main {
        font-size: max(15pt, min(1.4rem, 4vw));
        width: min(max(min(90%, 20rem), calc(100% - min(60%, 350px) - 1rem)), 850px);
        position: absolute;
        left: 50%;
        transform: translateX(-50%);
    }
    html {
        scroll-padding-top: 2.5rem;
        overflow-y: auto;
    }
    body {
        scroll-padding-top: 2.5rem;
        overflow-y: hidden;
        max-width: none !important;
    }
    .loadingMessage {
        text-align: center;
        margin-top: 40vh;
        font-size: 1.2rem;
    }
    blockquote {
        margin: 1rem 0.5rem;
        padding-left: 0.5em;
        padding-right: 0.5em;
        border-left: 2px solid #e6e6e6;
        border-right: 2px solid #e6e6e6;
        color: #444;
        background-color: #ebebeb;
    }
    details {
        cursor: pointer;
    }
    figure {
        margin-inline: 0.5rem;
    }
    figure img {
        display: block;
        margin-left: auto;
        margin-right: auto;
        max-width: 100%;
    }
    figure figcaption {
        font-size: max(12pt, min(1.1rem, 5.5vw));
        text-align: center;
    }
    a {
        color: blue;
    }
    a:visited {
        color: purple;
    }
    h1 {
        position: relative;
        margin-top: 5rem;
    }
    h1:before {
        content: '';
        position: absolute;
        width: 100%;
        height: 1px;
        background: black;
        bottom: 150%;
        left: 0;
    }
    *[role="doc-biblioref"] {
        color: green !important;
    }
    div.sourceCode {
        background-color: #dfdfdf;
        padding: 0.5rem;
        border: 1pt solid black;
        font-size: max(12pt, min(1.1rem, 5.5vw));
    }
    .copyButton {
        float: right;
        cursor: pointer;
    }
    .header-section-number::after {
        content: ':'
    }
    @keyframes fade {
        0%,100% { opacity: 0 }
        15% { opacity: 1 }
        85% { opacity: 1 }
    }
    .copyMessage {
        position: absolute;
        transform: translate(-2rem, -2.8rem);
        width: 4rem;
        font-size: max(10pt, min(0.7rem, 4vw));
        text-align: center;
        background-color: #eee;
        border: 1pt solid black;
        border-radius: 0.25rem;
        animation: fade 2s linear;
    }
</style>
<script>
    document.onreadystatechange = () => {
        if (document.readyState !== "complete") {
            document.querySelector("#main").style.display = "none";
            document.querySelector(".navbar").style.display = "none";
            document.querySelector("#loader").style.visibility = "visible";
        } else {
            document.querySelector("#loader").style.display = "none";
            document.querySelector(".navbar").style.display = "flex";
            document.querySelector("#main").style.display = "block";
        }
    };
    window.onload = () => {
        appendixSecNo = renumberAppendix();
        addRefsToToc();
        eqRefExpandLinksAndAddTooltips();
        citeRefExpandLinksAndAddTooltips();
        secRefExpandLinksAndAddBackArrow(appendixSecNo);
        addFootnoteTooltips();
        addCodeCopyButtons();
        tocHelpers();
        drawAllSvgPlots();
    }
    renumberAppendix = () => {
        const appendixEl = document.getElementById('appendix') || document.getElementById('sec:appendix');
        const appendixSecNo = appendixEl.getAttribute('data-number');
        appendixEl.setAttribute('data-number', 'A');
        appendixEl.firstChild.remove();
        const appendixSections = [...document.getElementsByTagName('*')].filter(el => {
            return (el.getAttribute('data-number') || 'a').split('.')[0] === appendixSecNo;
        })
        for (apSec of appendixSections){
            const numSplit = apSec.getAttribute('data-number').split('.');
            const secNo = 'A.' + numSplit.slice(1).join('.');
            apSec.setAttribute('data-number', secNo);
            apSec.firstChild.textContent = secNo;
        }
        const tocEls = [...document.getElementsByClassName('toc-section-number')].filter(el => {
            return (el.textContent).split('.')[0] === appendixSecNo;
        })
        for (tocEl of tocEls) {
            if (tocEl.textContent == appendixSecNo){
                tocEl.remove();
            } else {
                const numSplit = tocEl.textContent.split('.');
                const secNo = 'A.' + numSplit.slice(1).join('.');
                tocEl.textContent = secNo;
            }
        }
        return appendixSecNo
    }
    tocHelpers = () => {
        for (el of document.querySelectorAll('#TOC a')){
            const hrefId = el.getAttribute('href').slice(1);
            let parentEl = el.parentNode;
            let numUlsNested = 0;
            while (!!parentEl){
                numUlsNested += (parentEl.tagName == 'UL') ? 1 : 0
                parentEl = parentEl.parentNode
            }
            innerHTML = el.innerHTML;
            el.innerHTML = '';
            newEl = document.createElement('div');
            newEl.innerHTML = innerHTML;
            newEl.style.marginLeft = numUlsNested * 0.4 + 'rem';
            newEl.style.display = 'flex';
            newEl.innerHTML = innerHTML;
            if (numUlsNested > 1) {
                el.parentNode.classList.add('tocHideable');
                el.parentNode.classList.add('tocHidden');
            } 
            liParent = el.parentNode;
            if (liParent.getElementsByTagName('UL').length > 0) {
                expandEl = document.createElement('span');
                expandEl.innerHTML = '&nbsp;+&nbsp;';
                expandEl.classList = ['tocExpand'];
                newEl.appendChild(expandEl);
                ((expandEl, liParent) => {
                    expandEl.onclick = (e) => {
                        for (hideable of [...liParent.getElementsByClassName('tocHideable')]){
                            let hideableParent = hideable.parentNode;
                            while (hideableParent.tagName !== 'LI'){
                                hideableParent = hideableParent.parentNode
                            }
                            if (hideableParent !== liParent) {
                                continue
                            }
                            if ([...hideable.classList].includes('tocHidden')) {
                                hideable.classList.remove('tocHidden');
                                expandEl.innerHTML = '&nbsp;-&nbsp;';
                            } else {
                                hideable.classList.add('tocHidden');
                                expandEl.innerHTML = '&nbsp;+&nbsp;';
                            }
                        };
                        e.preventDefault();
                    }
                })(expandEl, liParent)
            }
            el.appendChild(newEl);
        }
    }
    addCodeCopyButtons = () => {
        buttonAddFunc = () => {
            copyButtons = document.querySelectorAll('.copyButton');
            wide = 700;
            if (copyButtons.length > 0) {
                if (window.innerWidth < wide) {
                    for (cb of copyButtons){
                        cb.remove();
                    }
                }
            } else {
                if (window.innerWidth >= wide) {
                    for (el of document.querySelectorAll('div.sourceCode')){
                        copyEl = document.createElement('span');
                        el.insertBefore(copyEl, el.firstChild);
                        copyEl.innerHTML = 'ðŸ“‹';
                        copyEl.classList = ['copyButton'];
                        ((el, copyEl) => {
                            copyEl.onclick = () => {
                                text = el.getElementsByTagName('pre')[0].textContent;
                                navigator.clipboard.writeText(text);
                                infoEl = document.createElement('div');
                                infoEl.textContent = 'Copied!';
                                infoEl.classList = ['copyMessage']
                                copyEl.appendChild(infoEl);
                                setTimeout(() => infoEl.remove(), 2000);
                            };
                        })(el, copyEl)
                    }
                }
            }
        }
        buttonAddFunc();
        window.addEventListener("resize", buttonAddFunc);
    }
    addRefsToToc = () => {
        liEl = document.createElement('li');
        aEl = document.createElement('a');
        aEl.href = '#References';
        aEl.innerHTML = 'References';
        ulEl = document.getElementById('TOC').getElementsByTagName('ul')[0];
        liEl.appendChild(aEl);
        ulEl.appendChild(liEl);
    }
    addTooltips = (els, includeLinkBacks) => {
        for ([i, el] of els.entries()) {
            ((el, i) => {
                refId = el.getAttribute('href');
                refEl = document.getElementById(refId.slice(1));
                el.setAttribute('href', '#');
                el.classList = ['eqnRef'];
                nextEl = document.createElement('span');
                el.parentNode.insertBefore(nextEl, el.nextSibling);
                popupId = refId + 'popup' + i;
                elId = popupId + 'Ref';
                nextEl.id = elId;
                ((a, b, c, d, e) => {
                    a.onclick = () => {
                        footnoteOnTooltipClick(b, c, d, e);
                        return false
                    };                
                })(el, popupId, refEl.innerHTML, elId, includeLinkBacks ? refId.slice(1) : null)
                if (includeLinkBacks) {
                    backId = 'back' + refId;
                    backEl = document.getElementById(backId);
                    if (!!!backEl) {
                        backEl = document.createElement('div');
                        backEl.id = backId;
                        backEl.style.marginTop = 'auto';
                        backArrowEl = document.createElement('a');
                        backArrowEl.id = backId + 'Arrow';
                        backArrowEl.innerHTML = "â†©ï¸Ž";
                        backArrowEl.style.display = 'none';
                        backEl.onclick = () => backEl.style.display = 'none';
                        backEl.appendChild(backArrowEl);
                        refEl.appendChild(backEl);
                    }
                }
            })(el, i)
        }
    }
    expandLinks = (els, prevWordInclude) => {
        for (const el of els) {
            sib = el.previousSibling;
            sibTextSplit = sib.textContent.split(/\s+/).filter(s => s !== '');
            prevWord = sibTextSplit[sibTextSplit.length - 1].replace('(', '');
            if (prevWordInclude.includes(prevWord)){
                repS = RegExp(`${prevWord}[^a-zA-Z]$`);
                el.innerHTML = prevWord + ' ' + el.innerHTML;
                sib.textContent = sib.textContent.replace(repS, '');
            }
        }
    }
    eqRefExpandLinksAndAddTooltips = () => {
        els = document.querySelectorAll('[href^="\#eq:"]');
        expandLinks(els, ['eq.', 'Equation']);
        addTooltips(els, true);
    }
    secRefExpandLinksAndAddBackArrow = (appendixSecNo) => {
        els = [...document.querySelectorAll('[href^="\#sec:"]')].filter(el => {
            return el.parentNode.tagName !== 'LI'
        });
        const appendixStr = 'the appendix';
        for (el of els) {
            if (el.textContent == appendixSecNo) {                
                sib = el.previousSibling;
                sib.remove();
                el.textContent = appendixStr;
            } else {
                el.textContent = document.getElementById(el.getAttribute('href').slice(1)).getAttribute('data-number');
            }
        }
        expandLinks(els.filter(el => el.textContent !== appendixStr), ['section']);
        for ([i, el] of els.entries()) {
            const secId = el.getAttribute('href').slice(1);
            const elId = 'linkToSec' + secId + i;
            el.id = elId;
            const toSec = document.getElementById(secId);
            el.onclick = () => {
                backArrowId = secId + 'ReturnLink';
                let backArrowEl = document.getElementById(backArrowId);
                if (!!backArrowEl) {
                    backArrowEl.remove();
                }
                backArrowEl = document.createElement('a');
                backArrowEl.id = backArrowId
                backArrowEl.setAttribute('href', '#' + elId);
                backArrowEl.style.float = 'right';
                backArrowEl.innerHTML = "â†©ï¸Ž";
                backArrowEl.onclick = () => backArrowEl.remove();
                toSec.appendChild(backArrowEl);
            }
        }
    }
    citeRefExpandLinksAndAddTooltips = () => {
        els = document.getElementById('main').getElementsByClassName('citation');
        addTooltips([...els].map(el => el.getElementsByTagName('a')[0]), false);
        for (el of els) {
            textContent = el.textContent;
            el.getElementsByTagName('a')[0].textContent = textContent;
            for (childEl of el.childNodes) {
                if (!!!childEl.tagName) {
                    childEl.textContent = '';
                }
            }
        }
    }
    addFootnoteTooltips = () => {
        for (fnBack of [...document.getElementById('main').getElementsByClassName('footnote-back')]) {
            fnBack.remove();
        }
        els = document.getElementById('main').getElementsByClassName('footnote-ref');
        addTooltips([...els], false);
        document.getElementById('footnotes').remove();
    }
</script>